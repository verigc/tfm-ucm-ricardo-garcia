Comment: "MÃ¡quina trabajadora que procesa un lote de sensores OpenAQ"
StartAt: Map
States:
  Map:
    Type: Map
    ItemProcessor:
      ProcessorConfig:
        Mode: INLINE
      StartAt: Obtener mediciones para cada sensor
      States:
        Obtener mediciones para cada sensor:
          Type: Task
          Resource: "arn:aws:states:::lambda:invoke"
          Parameters:
            FunctionName: "${LambdaGetOpenAqDataArn}" # <-- Usa la variable que definimos en el template.yaml
            Payload:
              "$": "$"
          Retry:
            - ErrorEquals:
                - "Lambda.ServiceException"
                - "Lambda.AWSLambdaException"
                - "Lambda.SdkClientException"
              IntervalSeconds: 2
              MaxAttempts: 3
              BackoffRate: 2
          End: true
    End: true
    MaxConcurrency: 1 # Puedes aumentar la concurrencia si la API lo permite